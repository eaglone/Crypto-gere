<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord de Trading</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Tableau de Bord de Trading</h1>
    </header>

    <section id="dashboard">
        <h2>Mon Tableau de Bord</h2>
        <p>Valeur totale actuelle de mon portefeuille : <span id="portfolio-value">$0.00 / €0.00</span></p>
        <div id="portfolio-list">Aucune cryptomonnaie dans le portefeuille.</div>

        <!-- Formulaire d'ajout -->
        <div id="trade-form">
            <h3>Ajouter une cryptomonnaie</h3>
            <label for="trade-crypto">Crypto :</label>
            <select id="trade-crypto" class="alert-input">
                <!-- Les options seront ajoutées dynamiquement -->
            </select>
            <label for="trade-amount">Quantité :</label>
            <input type="number" id="trade-amount" step="0.0001" placeholder="ex : 1.5" class="alert-input">
            <label for="buy-threshold">Seuil d'achat (USD) :</label>
            <input type="number" id="buy-threshold" step="0.01" placeholder="ex : 50000" class="alert-input">
            <label for="sell-threshold">Seuil de vente (USD) :</label>
            <input type="number" id="sell-threshold" step="0.01" placeholder="ex : 60000" class="alert-input">
            <input type="submit" id="add-button" value="Ajouter au portefeuille">
        </div>
    </section>

    <footer>
        <p>© 2024 Mon Site de Trading</p>
    </footer>

    <script>
        let portfolio = {};
        const alertSound = new Audio('alert-sound.mp3'); // Remplacez par le chemin de votre fichier audio

        // Charger les cryptomonnaies dans le menu déroulant
        async function loadCryptoOptions() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd');
                const data = await response.json();
                const selectElement = document.getElementById('trade-crypto');

                data.forEach(crypto => {
                    const option = document.createElement('option');
                    option.value = crypto.id;
                    option.textContent = crypto.name;
                    selectElement.appendChild(option);
                });
            } catch (error) {
                console.error('Erreur lors du chargement des options de l\'API CoinGecko:', error);
            }
        }

        loadCryptoOptions();

        // Ajouter la crypto sélectionnée au portefeuille
        document.getElementById('add-button').addEventListener('click', async () => {
            const selectedCryptoId = document.getElementById('trade-crypto').value;
            const selectedCryptoAmount = parseFloat(document.getElementById('trade-amount').value);
            const buyThreshold = parseFloat(document.getElementById('buy-threshold').value);
            const sellThreshold = parseFloat(document.getElementById('sell-threshold').value);

            if (!selectedCryptoId || isNaN(selectedCryptoAmount) || selectedCryptoAmount <= 0) {
                alert('Veuillez sélectionner une crypto et entrer une quantité valide.');
                return;
            }

            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${selectedCryptoId}`);
                const data = await response.json();
                const crypto = data[0];

                portfolio[selectedCryptoId] = {
                    name: crypto.name,
                    image: crypto.image,
                    price_usd: crypto.current_price,
                    price_eur: await getPriceInEUR(selectedCryptoId),
                    amount: selectedCryptoAmount,
                    buyThreshold: isNaN(buyThreshold) ? null : buyThreshold,
                    sellThreshold: isNaN(sellThreshold) ? null : sellThreshold
                };

                updatePortfolioDisplay();
                checkAlerts(selectedCryptoId);
            } catch (error) {
                console.error('Erreur lors de l\'ajout de la cryptomonnaie:', error);
                alert('Impossible d\'ajouter la cryptomonnaie. Veuillez réessayer.');
            }
        });

        // Obtenir le prix en EUR
        async function getPriceInEUR(cryptoId) {
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${cryptoId}&vs_currencies=eur`);
                const data = await response.json();
                return data[cryptoId].eur;
            } catch (error) {
                console.error('Erreur lors de la récupération du prix en EUR:', error);
                return null;
            }
        }

        // Met à jour l'affichage du portefeuille et calcule la valeur totale
        function updatePortfolioDisplay() {
            const portfolioList = document.getElementById('portfolio-list');
            portfolioList.innerHTML = ''; // Vider le contenu précédent
            let totalValueUSD = 0;
            let totalValueEUR = 0;

            for (const [id, crypto] of Object.entries(portfolio)) {
                const currentValueUSD = crypto.price_usd * crypto.amount;
                const currentValueEUR = crypto.price_eur * crypto.amount;
                totalValueUSD += currentValueUSD;
                totalValueEUR += currentValueEUR;

                const portfolioItem = document.createElement('div');
                portfolioItem.className = 'portfolio-item';
                portfolioItem.innerHTML = `
                    <div>
                        <img src="${crypto.image}" alt="${crypto.name}" style="width: 32px; vertical-align: middle;"> 
                        <strong>${crypto.name}</strong> : ${crypto.amount.toFixed(4)} unités
                        <p>Prix actuel : $${crypto.price_usd.toFixed(2)} / €${crypto.price_eur.toFixed(2)}</p>
                    </div>
                    <div>
                        Valeur: $${currentValueUSD.toFixed(2)} / €${currentValueEUR.toFixed(2)}
                    </div>
                `;
                portfolioList.appendChild(portfolioItem);
            }

            document.getElementById('portfolio-value').textContent = `$${totalValueUSD.toFixed(2)} / €${totalValueEUR.toFixed(2)}`;
        }

        // Vérifie si une alerte doit être déclenchée
        function checkAlerts(cryptoId) {
            const crypto = portfolio[cryptoId];

            if (crypto.buyThreshold && crypto.price_usd <= crypto.buyThreshold) {
                alert(`Alerte : ${crypto.name} a atteint le seuil d'achat ($${crypto.buyThreshold})`);
                alertSound.play();
            }

            if (crypto.sellThreshold && crypto.price_usd >= crypto.sellThreshold) {
                alert(`Alerte : ${crypto.name} a atteint le seuil de vente ($${crypto.sellThreshold})`);
                alertSound.play();
            }
        }
    </script>
</body>
</html>
